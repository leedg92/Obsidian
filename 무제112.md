# 터미널 모니터링 시스템 설계 문서

## 1. 시스템 개요

본 시스템은 다중 터미널의 리소스 상태(메모리, 스레드, 데드락) 및 헬스 상태를 실시간으로 수집, 저장, 조회하는 백엔드 모니터링 시스템입니다. 주기적인 데이터 수집과 장기 보관을 위한 아카이빙 기능을 제공합니다.

## 2. 예상 컴포넌트 구조도

### 2.1 시스템 아키텍처 개요

본 시스템은 계층형 아키텍처를 기반으로 하며, 각 계층은 명확한 책임을 가지고 독립적으로 동작합니다.

- **API 게이트웨이 계층**: 외부 클라이언트 요청 처리 및 인증/인가
- **비즈니스 로직 계층**: 데이터 수집, 처리, 아카이빙 로직
- **데이터 접근 계층**: 데이터베이스 및 외부 API 통신
- **데이터 저장 계층**: 실시간 데이터 저장 및 아카이브 저장소

### 2.2 컴포넌트 구조도

```mermaid
graph TB
    %% 외부 시스템
    Client[클라이언트<br/>시스템]
    Terminal1[터미널A<br/>시스템]
    Terminal2[터미널B<br/>시스템]
    Terminal3[터미널C<br/>시스템]
    
    %% API 게이트웨이 계층
    subgraph "API 게이트웨이 계층"
        Gateway[API 게이트웨이]
        Auth[인증/인가<br/>모듈]
        Validation[요청 검증<br/>모듈]
    end
    
    %% 비즈니스 로직 계층
    subgraph "비즈니스 로직 계층"
        Scheduler[스케줄링<br/>엔진]
        DataCollector[데이터 수집<br/>서비스]
        MonitoringService[모니터링<br/>서비스]
        ArchiveService[아카이빙<br/>서비스]
    end
    
    %% 데이터 접근 계층
    subgraph "데이터 접근 계층"
        APIClient[외부 API<br/>클라이언트]
        Repository[데이터<br/>저장소]
        FileHandler[파일<br/>처리기]
    end
    
    %% 데이터 저장 계층
    subgraph "데이터 저장 계층"
        Database[(운영<br/>데이터베이스)]
        Archive[(아카이브<br/>스토리지)]
        Config[(설정<br/>저장소)]
    end
    
    %% 연결 관계
    Client --> Gateway
    Gateway --> Auth
    Gateway --> Validation
    Gateway --> MonitoringService
    
    Scheduler --> DataCollector
    DataCollector --> APIClient
    MonitoringService --> Repository
    ArchiveService --> Repository
    ArchiveService --> FileHandler
    
    APIClient --> Terminal1
    APIClient --> Terminal2
    APIClient --> Terminal3
    Repository --> Database
    Repository --> Config
    FileHandler --> Archive
    
    %% 스타일링
    classDef external fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef gateway fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef business fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef data fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef storage fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    
    class Client,Terminal1,Terminal2,Terminal3 external
    class Gateway,Auth,Validation gateway
    class Scheduler,DataCollector,MonitoringService,ArchiveService business
    class APIClient,Repository,FileHandler data
    class Database,Archive,Config storage
```

### 2.3 컴포넌트 설명

#### API 게이트웨이 계층
- **API 게이트웨이**: 모든 외부 요청의 진입점, 라우팅 및 로드밸런싱
- **인증/인가 모듈**: 클라이언트 인증 및 권한 검증
- **요청 검증 모듈**: 입력 데이터 유효성 검사 및 스키마 검증

#### 비즈니스 로직 계층
- **스케줄링 엔진**: 주기적 작업 관리 (데이터 수집, 아카이빙)
- **데이터 수집 서비스**: 터미널별 리소스 정보 수집 및 처리
- **모니터링 서비스**: 실시간 상태 조회 및 알림 처리
- **아카이빙 서비스**: 장기 데이터 보관 및 압축 처리

#### 데이터 접근 계층
- **외부 API 클라이언트**: 터미널 시스템과의 HTTP 통신
- **데이터 저장소**: 데이터베이스 추상화 및 CRUD 연산
- **파일 처리기**: 아카이브 파일 생성, 압축, 관리

#### 데이터 저장 계층
- **운영 데이터베이스**: 실시간 모니터링 데이터 저장
- **아카이브 스토리지**: 장기 보관용 압축 파일 저장
- **설정 저장소**: 터미널 엔드포인트 및 시스템 설정

## 3. 예상 데이터 흐름도

### 3.1 데이터 수집 흐름

시스템의 핵심인 데이터 수집은 주기적으로 실행되며, 다중 터미널로부터 병렬로 데이터를 수집합니다.

```mermaid
flowchart TD
    Start([스케줄러 시작])
    
    %% 초기화 단계
    Start --> LoadConfig[시스템 설정<br/>로드]
    LoadConfig --> GetEndpoints[활성 터미널<br/>엔드포인트 조회]
    
    %% 데이터 수집 단계
    GetEndpoints --> GroupTerminals[터미널별<br/>그룹화]
    GroupTerminals --> ParallelCollect{병렬 데이터<br/>수집 실행}
    
    %% 터미널별 처리
    ParallelCollect --> Terminal1[터미널A<br/>데이터 수집]
    ParallelCollect --> Terminal2[터미널B<br/>데이터 수집]
    ParallelCollect --> Terminal3[터미널C<br/>데이터 수집]
    
    %% 개별 터미널 처리 흐름
    Terminal1 --> API1[HTTP API<br/>호출]
    Terminal2 --> API2[HTTP API<br/>호출]
    Terminal3 --> API3[HTTP API<br/>호출]
    
    API1 --> Store1[데이터베이스<br/>저장]
    API2 --> Store2[데이터베이스<br/>저장]
    API3 --> Store3[데이터베이스<br/>저장]
    
    %% 결과 집계
    Store1 --> Aggregate[수집 결과<br/>집계]
    Store2 --> Aggregate
    Store3 --> Aggregate
    
    Aggregate --> Log[실행 결과<br/>로깅]
    Log --> End([수집 완료])
    
    %% 에러 처리
    API1 --> ErrorHandle1[에러 처리<br/>및 로깅]
    API2 --> ErrorHandle2[에러 처리<br/>및 로깅]
    API3 --> ErrorHandle3[에러 처리<br/>및 로깅]
    
    ErrorHandle1 --> Aggregate
    ErrorHandle2 --> Aggregate
    ErrorHandle3 --> Aggregate
    
    %% 스타일링
    classDef startEnd fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    classDef process fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef decision fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef terminal fill:#fce4ec,stroke:#ad1457,stroke-width:2px
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class Start,End startEnd
    class LoadConfig,GetEndpoints,GroupTerminals,Aggregate,Log process
    class ParallelCollect decision
    class Terminal1,Terminal2,Terminal3,API1,API2,API3,Store1,Store2,Store3 terminal
    class ErrorHandle1,ErrorHandle2,ErrorHandle3 error
```

### 3.2 데이터 조회 흐름

클라이언트의 조회 요청에 대한 실시간 응답 처리 흐름입니다.

```mermaid
flowchart TD
    ClientReq[클라이언트<br/>요청] --> Validate[요청 파라미터<br/>검증]
    
    Validate --> AuthCheck{인증<br/>확인}
    AuthCheck -->|성공| QueryDB[데이터베이스<br/>조회]
    AuthCheck -->|실패| AuthError[인증 실패<br/>응답]
    
    QueryDB --> DataFound{데이터<br/>존재?}
    DataFound -->|있음| FormatData[응답 데이터<br/>포맷팅]
    DataFound -->|없음| NoDataResp[데이터 없음<br/>응답]
    
    FormatData --> SendResponse[클라이언트<br/>응답 전송]
    
    %% 에러 처리
    Validate --> ValidateError[검증 실패<br/>응답]
    QueryDB --> DBError[데이터베이스<br/>오류 응답]
    
    %% 로깅
    SendResponse --> LogAccess[접근 로그<br/>기록]
    AuthError --> LogAccess
    NoDataResp --> LogAccess
    ValidateError --> LogAccess
    DBError --> LogAccess
    
    LogAccess --> Complete([처리 완료])
    
    %% 스타일링
    classDef client fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef process fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef success fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    
    class ClientReq client
    class Validate,QueryDB,FormatData,LogAccess process
    class AuthCheck,DataFound decision
    class AuthError,ValidateError,DBError,NoDataResp error
    class SendResponse,Complete success
```

### 3.3 아카이빙 흐름

장기 데이터 보관을 위한 월별 아카이빙 처리 흐름입니다.

```mermaid
flowchart TD
    ScheduleStart([월별 스케줄러<br/>시작]) --> CalcPeriod[아카이브 대상<br/>기간 계산]
    
    CalcPeriod --> GetTerminals[활성 터미널<br/>목록 조회]
    GetTerminals --> ProcessTerminals{터미널별<br/>병렬 처리}
    
    %% 터미널별 처리
    ProcessTerminals --> Term1[터미널A<br/>아카이빙]
    ProcessTerminals --> Term2[터미널B<br/>아카이빙]
    ProcessTerminals --> Term3[터미널C<br/>아카이빙]
    
    %% 개별 터미널 아카이빙 흐름
    Term1 --> Extract1[데이터 추출]
    Term2 --> Extract2[데이터 추출]
    Term3 --> Extract3[데이터 추출]
    
    Extract1 --> Compress1[파일 압축<br/>및 저장]
    Extract2 --> Compress2[파일 압축<br/>및 저장]
    Extract3 --> Compress3[파일 압축<br/>및 저장]
    
    Compress1 --> Verify1{백업<br/>성공?}
    Compress2 --> Verify2{백업<br/>성공?}
    Compress3 --> Verify3{백업<br/>성공?}
    
    Verify1 -->|성공| Delete1[원본 데이터<br/>삭제]
    Verify2 -->|성공| Delete2[원본 데이터<br/>삭제]
    Verify3 -->|성공| Delete3[원본 데이터<br/>삭제]
    
    Verify1 -->|실패| Error1[백업 실패<br/>처리]
    Verify2 -->|실패| Error2[백업 실패<br/>처리]
    Verify3 -->|실패| Error3[백업 실패<br/>처리]
    
    %% 결과 집계
    Delete1 --> Summary[아카이빙 결과<br/>집계]
    Delete2 --> Summary
    Delete3 --> Summary
    Error1 --> Summary
    Error2 --> Summary
    Error3 --> Summary
    
    Summary --> Report[실행 보고서<br/>생성]
    Report --> NotifyComplete[완료 알림<br/>및 로깅]
    NotifyComplete --> ArchiveEnd([아카이빙 완료])
    
    %% 스타일링
    classDef schedule fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    classDef process fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef decision fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef terminal fill:#fce4ec,stroke:#ad1457,stroke-width:2px
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef success fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    
    class ScheduleStart,ArchiveEnd schedule
    class CalcPeriod,GetTerminals,Extract1,Extract2,Extract3,Compress1,Compress2,Compress3,Summary,Report,NotifyComplete process
    class ProcessTerminals,Verify1,Verify2,Verify3 decision
    class Term1,Term2,Term3 terminal
    class Error1,Error2,Error3 error
    class Delete1,Delete2,Delete3 success
```

## 4. 설계 특징

### 4.1 확장성
- 모듈형 아키텍처로 새로운 터미널 추가 시 설정만 변경
- 메트릭 타입 확장 가능한 구조
- 마이크로서비스 아키텍처 적용 가능

### 4.2 안정성
- 각 터미널별 독립적 처리로 장애 격리
- 다단계 에러 처리 및 복구 메커니즘
- 백업 검증 후 원본 삭제하는 안전한 아카이빙

### 4.3 성능
- 병렬 처리를 통한 수집 성능 최적화
- 비동기 I/O 활용한 고성능 API 서버
- 인덱스 최적화된 데이터베이스 설계

### 4.4 운영성
- 구조화된 로깅 시스템
- 실시간 모니터링 및 알림 지원
- 자동화된 아카이빙 및 데이터 관리