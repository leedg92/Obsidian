#### forTrucker 붙은 앤드포인트 : 운송사웹 -> bctrans 요청 부

## **반출입 유효성 검증 함수 흐름(1~5)**

### 1. 메서드별

### 1️⃣ **운송사 → bctrans**
```
   HTTP POST /tss/group/trucker/verify
	   ↓
   [TssGroupOrderController.java -> veriftGroupOrderByTrucker]
   TssGroupOrderController.veriftGroupOrderByTrucker()
	   ↓
   [TssGroupOrderService.java, verifyGroupOrderByTrucker]
   TssGroupOrderService.verifyGroupOrderByTrucker()
```

### 2️⃣ **bctrans → 터미널**
```
	   ↓
   [TssGroupOrderService.java -> requestTransOrderNoVerify]
   requestTransOrderNoVerify()
	   ↓
   [TssGroupOrderAsyncService.java -> requestTransOrderNoVerify]
   TssGroupOrderAsyncService.requestTransOrderNoVerify()
	   ↓
   apiRestTemplate.exchange(터미널URL, POST, 검증데이터)
```

### 3️⃣ **터미널 처리 (외부 시스템)**

### 4️⃣ **터미널 → bctrans (콜백)**
```
   HTTP POST /tss/group/invoke/verifyResult/group
	   ↓
   [TssGroupOrderAlarmController.java -> saveGroupOrderTerminalVerifyResultAsync]
   TssGroupOrderAlarmController.saveGroupOrderTerminalVerifyResultAsync()
	   ↓
   [TssGroupOrderService.java -> processGroupOrderTerminalVerifyResultAsync]
   TssGroupOrderService.processGroupOrderTerminalVerifyResultAsync()
```

### 5️⃣ **bctrans → 운송사**
```
	   ↓
   [TssGroupOrderPushService.java -> sendGroupOrderVerifyResultAlarm]
   TssGroupOrderPushService.sendGroupOrderVerifyResultAlarm()
	   ↓
   webClientService.sendRequestAsync(운송사URL, POST, 결과데이터)
```

### 2. url별

### 1️⃣ **운송사 → bctrans**
```
POST /tss/group/trucker/verify
Body: { dispatchGroup, conList, truckList }  // 콜백 URL 없음 ❌
```

### 2️⃣ **bctrans → 터미널**
```
POST {터미널API}/verify
Body: { 검증데이터 }
```
   
### 3️⃣ **터미널 → bctrans (고정 URL)**
```
POST /tss/group/invoke/verifyResult/group  // 🔒 고정된 콜백 URL
Body: { 검증결과 }
```
   
### 4️⃣ **bctrans → 운송사 (사전 등록된 URL)**
```
POST {운송사콜백URL}/group/verify/result   // 🗃️ DB에서 조회한 URL
Body: { 검증결과 }
```

---

## **그룹 정보 생성 함수 흐름(6~7)**

### 1. 메서드별

### 6️⃣ **운송사 → bctrans**
```
HTTP POST /tss/group/trucker/create
   ↓
[TssGroupOrderController.java -> createShippingOrderAndGroupOrder]
TssGroupOrderController.createShippingOrderAndGroupOrder()
   ↓
[TssGroupOrderService.java -> createGroupOrderForTrucker]
TssGroupOrderService.createGroupOrderForTrucker()
```

### 7️⃣ **bctrans 내부 처리**
```
   ↓
[TssGroupOrderService.java -> assertValidate]
assertValidate() - 유효성 검증
   ↓
[TssGroupOrderRepository.java -> selectExistsContainer]
selectExistsContainer() - 중복 체크
   ↓
dispatchGroup 자동 생성
   ↓
[BChainService.java, exchange]
bChainService.exchange("/trans/CreateCopinoWithGroup") - BC 코피노 생성
   ↓
[TssGroupOrderService.java, createGroupOrder]
createGroupOrder() → saveGroupOrder() - DB 저장
   ↓
[TssGroupOrderService.java, verifyGroupOrderByTrucker]
verifyGroupOrderByTrucker() - 자동 유효성 검증 실행
```

### 2. url별

### 6️⃣ **운송사 → bctrans**
```
POST /tss/group/trucker/create
Body: { conList, truckList }  // dispatchGroup 없음, bctrans가 자동 생성
```

### 7️⃣ **bctrans → BC**
```
POST {BC_URL}/trans/CreateCopinoWithGroup
Body: { info: {운송사정보}, data: {배차그룹, 컨테이너목록} }
```

**참고**: 그룹 생성 완료 후 자동으로 **반출입 유효성 검증 프로세스(1-5번)**가 실행됨