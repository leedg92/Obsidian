---

본 문서는 BPA 블록체인 퍼징(테스트베드, 운영망)을 위한 메뉴얼이며, 블록체인 네트워크를 초기화하고 새로운 네트워크를 생성하는 과정을 설명한다.

블록체인 네트워크 퍼지은 다음과 같은 순서로 진행한다.

1. 사전 준비 퍼징 도구를 다운받고, 퍼징에 필요한 데이터 생성 및 코드 작업 진행
2. 네트워크 삭제 기존 블록체인 네트워크를 삭제하고, 관련 인스턴스들의 상태를 점검
3. 네트워크 생성 새로운 블록체인 네트워크를 생성하고, 관련 인스턴스들의 상태를 점검
4. 피어 생성 새로운 피어를 생성하고, 관련 인스턴스들의 상태를 점검
5. 채널 생성, 조인 및 체인코드 배포 퍼징 도구를 통해 생성된 채널 데이터를 등록하고, 피어별로 조인, 체인코드 배포
6. 테스트 코드 실행 채널/체인코드별 체인코드 테스트 진행(E2E)
7. 인덱스 작업 피어별 DB에 인덱스 작업 진행, 6번 작업이 선행되어야 함

---

<aside> 💡 ACCIO에서 에러가 발생할 경우, 반동지사에 연락…

</aside>

# 1. 사전 준비

### 1.1. 사전 툴 다운로드

- lens 설치 후 .kube폴더 생성 후 config 파일 업로드
    
    [config](attachment:1fbe8766-0f6c-4e21-a4ce-ff30d74c8d1b:config.txt)
    
    - 로컬 터미널에서 진행할 경우(k8s 설치 필요)
        - k8s 설정 파일 이동
            
            ```bash
            
            # 아래 ~/.kube 디렉토리에 config 파일 이동
            ~/.kube/config
            ```
            
        - k8s ns 확인
            
            ```bash
            # K8S ns 불러오기
            kubectl get ns
            ```
            
            ![image.png](attachment:a6580e53-9f93-4874-abc0-f919eb057487:image.png)
            
- 사내 gitlab에서 퍼징 도구 다운로드
    
    [https://gitlab.smartm2m.co.kr/bpa/purging_util](https://gitlab.smartm2m.co.kr/bpa/purging_util)
    

### 1.2. 채널 목록 생성 및 전달

<aside> 💡

퍼징도구로 생성된 채널 목록(chennel 디렉토리)를 체인코드 담당자에게 전달

</aside>

- automation 채널 목록 생성
    
    - automation
    
    ```bash
    # automation 실행
    cd automation
    ./automation.sh
    ```
    
    ![automation.sh 실행 시 출력 로그](attachment:e1b7dc7b-5380-4c26-baf7-e6a35393b4ab:image.png)
    
    [automation.sh](http://automation.sh) 실행 시 출력 로그
    
    ![automation.sh 실행 시 생성 파일](attachment:2674a393-0d52-43db-8b58-2beb8d5ed744:image.png)
    
    [automation.sh](http://automation.sh) 실행 시 생성 파일
    
    - 채널 목록 파일 전달 automation/channel
        
        강원태 팀장: itt-channels.txt, port-i-channels.txt, vbs-channels.txt
        
        ![채널 목록 파일(팀장-컨테인어스 전달)](attachment:aac46f58-7502-4a1e-8651-083bc7375ad6:image.png)
        
        채널 목록 파일(팀장-컨테인어스 전달)
        
    - 채널 템플릿 파일 전달 automation/template
        
        ACCIO 기술지원팀: channels.txt
        
        ![채널 템플릿파일(ACCIO 기술 지원팀 전달)](attachment:0277d869-e9dd-4a0a-9faa-52fea01035c9:image.png)
        
        채널 템플릿파일(ACCIO 기술 지원팀 전달)
        
    - 터미널 외 구분 코드: KCTPC011, KJTLC050
        

### 1.3. 체인코드 다운로드

- TSS(itt) 체인코드 설치
    
    <aside> 💡
    
    채널 목록이 반영된 상태의 코드 다운로드
    
    </aside>
    
    깃랩에서 소스코드를 다운로드할 수 있으며, ZIP 파일으로 설치
    
    ![itt 체인코드 소스코드](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/3a32e41c-3894-44ca-8c0a-647dcfe12986/Untitled.png)
    
    itt 체인코드 소스코드
    
- VBS 체인코드 다운로드
    
    깃랩에서 소스코드를 다운로드할 수 있으며, ZIP 파일으로 설치
    
    ![vbs 체인코드 소스코드](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/3ea9b5df-dda9-4127-91e5-fba74734482d/Untitled.png)
    
    vbs 체인코드 소스코드
    
    - Port-i 체인코드 설치
        
        깃랩에서 소스코드를 다운로드할 수 있으며, ZIP 파일으로 설치
        
    
    ![port-i 체인코드 소스코드](attachment:d5fc5d7a-9ed0-430e-92b2-950f1525dfaa:image.png)
    
    port-i 체인코드 소스코드
    

## 2. 네트워크 초기화

퍼징 작업을 위해 네트워크 초기화 작업을 진행함. 네트워크는 바로 삭제하지 못하고, 피어 - 조직 - 네트워크 순으로 삭제를 진행해야 함

<aside> 💡

네트워크 삭제 후, ACCIO 기술지원팀에 인스턴스 및 스토리지 확인 요청

</aside>

### 2.1. 피어 삭제

![ACCIO - 피어 삭제](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/743b729b-16a9-4b3c-a3fc-f72f47117e88/image.png)

ACCIO - 피어 삭제

Organization별로 존재하는 피어들을 모두 삭제

### 2.2. 조직 삭제

![ACCIO - 조직 삭제](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/aad99c95-246b-4897-b424-ccee38fd525f/image.png)

ACCIO - 조직 삭제

조직 정보 삭제할 때, 피어 정보가 남아있으면 삭제가 되지 않음

### 2.3. 네트워크 삭제

![ACCIO - 네트워크 삭제](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/ca82730a-1aed-4e74-92c5-43a17d57b2f8/image.png)

ACCIO - 네트워크 삭제

![ACCIO - 블록체인 네트워크 초기화 상태](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/90888810-4411-41ad-ab6d-98b5bf3822b8/image.png)

ACCIO - 블록체인 네트워크 초기화 상태

기존에 존재하던 블록체인 네트워크 삭제

### 2.5. 네트워크 삭제 후 확인 사항

<aside> 💡

네트워크 삭제 후, ACCIO 기술지원팀에 인스턴스 및 스토리지 확인 요청

2025년 추석 이후로, CouchDB 삭제 여부도 확인

</aside>

(테스트베드) 렌즈에서 pods 및 네임스페이스 삭제완료 되었는지 확인

![Lens - pods 및 네임스페이스 초기화 확인](attachment:75cbb4b3-9804-4e86-9a6e-d49d3349af7c:image.png)

Lens - pods 및 네임스페이스 초기화 확인

(테스트베드) 스토리지 초기화 확인

![Lens - 스토리지 초기화 확인](attachment:6ac29e65-2134-4f97-83be-4e72bf299930:image.png)

Lens - 스토리지 초기화 확인

## 3. Fabric Network 생성(ACCIO)

[](https://bpa.acciox.dev/fabric/en/create)

<aside> 💡

네트워크 생성 후, ACCIO 기술지원팀에 인스턴스 및 스토리지 확인 요청

</aside>

### 3.1. 네트워크 생성 및 오더러 설정

- 블록체인 네트워크 생성
    
    ![ACCIO - 블록체인 네트워크 생성 시. 초기 화면](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/8add1940-a8f2-483f-92eb-710a519d28e5/image.png)
    
    ACCIO - 블록체인 네트워크 생성 시. 초기 화면
    
    ![ACCIO - 블록체인 네트워크 생성 시 설정](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/0764abea-18cf-4806-843b-66fbeea9b6d4/Untitled.png)
    
    ACCIO - 블록체인 네트워크 생성 시 설정
    
- 오더러 초기 정보 입력
    
    ![ACCIO - 오더러 초기 설정](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/01cd7b78-93e7-4bfe-bf65-9a71947e6d1a/Untitled.png)
    
    ACCIO - 오더러 초기 설정
    

### 3.2. 조직 초기 정보 입력

- 조직 생성시 반드시 조직명을 BPA로 설정

<aside> 💡 CA Password ID: admin PW: Password123

</aside>

![ACCIO - 조직 생성 시 설정](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/e2b40324-5f4d-4199-98f2-502f08197c40/Untitled.png)

ACCIO - 조직 생성 시 설정

![ACCIO - 조직 생성 설정 검토](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/516e982c-9f78-4cb6-a2bc-fb9f5c76d3b2/Untitled.png)

ACCIO - 조직 생성 설정 검토

### 3.3. 피어 추가

- 피어 1 추가 생성 조직 생성시 , peer0가 생성되며, 추가로 피어를 생성해야 함
    
    ![ACCIO - 조직 생성 후 피어 현황](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/a126fe5b-5e0c-4bec-b6fe-37fae0b11526/Untitled.png)
    
    ACCIO - 조직 생성 후 피어 현황
    
    ![ACCIO - 피어 1 생성](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/4e0dd777-12a2-4d8e-a728-9745bc46b578/Untitled.png)
    
    ACCIO - 피어 1 생성
    
    ![ACCIO - 피어 1 생성 설정 확인](attachment:40bc9135-e57e-45a4-a5fc-a459069960fa:69c617de-5acf-47b4-8a41-c98541138249.png)
    
    ACCIO - 피어 1 생성 설정 확인
    
    ![ACCIO - 피어 추가후 현황](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/37e68998-ed1d-434d-80a5-802c2f397d1e/Untitled.png)
    
    ACCIO - 피어 추가후 현황
    
- 피어 추가 확인 Lens에서 파드가 생성되었는지 확인
    
    ![Lens - 파드 생성  확인](attachment:75c4e7e5-243a-4a7e-9602-cf1a958989b6:image.png)
    
    Lens - 파드 생성 확인
    

<aside> 💡 ACCIO 기술지원팀에 아래 사항 요청

1. CouchDB EndpointURL(인덱스 HTTP요청할 엔드포인트)
2. Port-i API-GW 생성 여부 확인
3. API-GW, Port-i API-GW의 엔드포인트 URL 확인
4. LOG(elasticsearch) 설정 확인 (테스트베드는 lens에서 1~4번 사항 확인 가능)

</aside>

- ACCIO 기술 지원팀 확인 사항(테스트베드인 경우 직접 수행 가능)
    
    1. CouchDB EndpointURL(인덱스 HTTP요청할 엔드포인트) Network > Ingresses 에서 아래사항 확인
        
        ![Lens - CouchDB Endpoint URL 확인](attachment:58ad6434-8cf0-4b40-8ae0-1bdd96094d5a:image.png)
        
        Lens - CouchDB Endpoint URL 확인
        
        1. `peer0-bpa-couchdb` 의 EndpointURL 확인
        2. `peer1-bpa-couchdb` 의 EndpointURL 확인
    2. Port-i API-GW 생성 여부 확인
        
        ![Lens - Port-i API-GW 확인](attachment:9ce84d43-019e-4fc6-a760-9ae808bd5589:image.png)
        
        Lens - Port-i API-GW 확인
        
    3. API-GW, Port-i API-GW의 엔드포인트 URL 확인 Network > Ingresses 에서 아래사항 확인
        
        1. `api-peer0-bpa` 의 /bpatest/ 의 링크가 [**](https://bpa.acciox.dev/bpatest/)[https://bpa.acciox.dev/bpatest/](https://bpa.acciox.dev/bpatest/)** 와 동일한지 확인
            
        2. `api-peer1-porti-bpa` 의 /porti-bpatest/ 의 링크가 [**](https://bpa.acciox.dev/porti-bpatest/)[https://bpa.acciox.dev/porti-bpatest/](https://bpa.acciox.dev/porti-bpatest/)** 와 동일한지 확인
            
            ![Lens - Port-i API-GW Endpoint URL 확인](attachment:101b5eb4-7890-4642-abf5-7df556909042:image.png)
            
            Lens - Port-i API-GW Endpoint URL 확인
            
            ![Lens - Port-i API-GW Endpoint URL 확인](attachment:a299f8f8-a36e-43e7-83cf-b850c00c6bda:image.png)
            
            Lens - Port-i API-GW Endpoint URL 확인
            
    4. LOG(elasticsearch) 설정 확인 Workloads > Deployments 에서 모든 peer에 대해 아래 설정여부 확인
        
        ![Lens - LOG(elasticsearch) 설정 확인](attachment:e409ca27-07cb-4fb3-ab30-fc8b2f51e112:image.png)
        
        Lens - LOG(elasticsearch) 설정 확인
        
    
    ```yaml
    env:
    - name: LOGGING_ENABLED
      value: 'true'
    - name: LOGGING_URL
      value: '<https://bpa.acciox.dev/logging/bpa.log>'
    ```
    
- Peer 네트워크 설정 확인(ACCIO 기술 지원팀에서 수행)
    
    - Peer Environment
        
        ```yaml
        # ingresses/api-peer0-bpa
        kind: Ingress
        metadata:
          name: api-peer0-bpa
          namespace: a649ba9a-dd32-11ef-8193-be4438005dec
          uid: 974b8339-3ee2-41b7-a426-3cc92bd24ce9
          resourceVersion: '189677458'
          generation: 2
          creationTimestamp: '2025-01-28T04:46:19Z'
          labels:
            app.kubernetes.io/managed-by: Helm
            ingress: api-peer0-bpa
            k8slens-edit-resource-version: v1
          annotations:
            meta.helm.sh/release-name: peer0-bpa
            meta.helm.sh/release-namespace: a649ba9a-dd32-11ef-8193-be4438005dec
            traefik.ingress.kubernetes.io/router.entrypoints: websecure
            **traefik.ingress.kubernetes.io/router.middlewares: traefik-traefik-stripprefix@kubernetescrd # 변경**
            traefik.ingress.kubernetes.io/router.tls: 'true'
        
        # 중략
        spec:
          ingressClassName: traefik
          tls:
            - secretName: network-certificate
          rules:
            - host: bpa.acciox.dev
              http:
                paths:
                  **- path: /bpatest/ # 변경**
                    pathType: Prefix
                    backend:
                      service:
                        name: api-peer0-bpa
                        port:
                          number: 3000
        
        ```
        

피어 생성 확인 후, 채널 생성 진행

### 3.4. 채널 생성 및 체인코드 배포

- purging-util의 automation template 코드 활용
- 채널을 대량으로 생성할 때, CSV 기반으로 생성(TSS, VBS, PORT-I)
    - peer0를 대상으로 채널을 생성
    - 이후 peer1에서 Join Channel을 통해 채널에 참가함
- 채널 별 템플릿 파일을 선택하여 순서대로 생성함
    - 아래 체인코드 배포 후에 다음 순서의 채널 생성을 진행할 것
    - 순서: [ ITT(220), VBS(40), PORT-I(10) ]
    - ittcc는 tss채널만, vbscc는 vbs채널만, porticc는 porti채널에만 추가

![ACCIO - 채널 생성 전 현황](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/6e6c1078-7730-4b84-be55-79f34bf8b2b7/image.png)

ACCIO - 채널 생성 전 현황

- ITT(TSS) 채널 생성 및 체인코드 배포
    
    - itt-template.csv 파일을 선택하여 채널을 생성
        
    - peer0를 선택하고 채널을 생성함
        
        ![ACCIO - ITT 채널 생성](attachment:b06905d3-ec1c-457e-8e16-a78b108ac9e6:image.png)
        
        ACCIO - ITT 채널 생성
        
        ![ACCIO - ITT 채널 생성 후 확인](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/e08cc1ba-a5e1-4950-9d9f-f7f46a9b684b/Untitled.png)
        
        ACCIO - ITT 채널 생성 후 확인
        
    - peer1에서 Join Channel로 추가한 채널에 등록함
        
        ![ACCIO - peer1 채널 확인](attachment:c0d53c7f-0bc7-4d56-96a0-306e52ba5a49:image.png)
        
        ACCIO - peer1 채널 확인
        
        ![ACCIO - ITT 채널에 peer1 등록](attachment:a3c6bb84-ac47-444b-8c76-92a2f24332c0:image.png)
        
        ACCIO - ITT 채널에 peer1 등록
        
    - TSS(itt) 체인코드 설치
        
        체인코드 명은 ittcc 로 해야함 반드시 다운 받은 itt 소스코드 zip 파일을 업로드하여 배포
        
        ![ACCIO - ITT 체인코드 설정(ITT 채널 선택)](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/4b84cb71-7625-4c47-9aeb-60e5a0110ec7/Untitled.png)
        
        ACCIO - ITT 체인코드 설정(ITT 채널 선택)
        
        ![ACCIO - ITT 체인코드 소스코드 업로드](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/e43bf583-3dee-4398-ac58-ba27c5461c26/Untitled.png)
        
        ACCIO - ITT 체인코드 소스코드 업로드
        
- VBS 채널 생성 및 체인코드 배포
    
    - vbs-template.csv 파일을 선택하여 채널을 생성
    - peer0를 선택하고 채널을 생성함
    - peer1에서 Join Channel로 추가한 채널에 등록함
    - VBS 체인코드 설치
    
    체인코드명은 vbscc 로 해야함 반드시 채널은 VBS 대상 채널로 총 40개를 선택해야 함
    
    ![ACCIO - VBS 체인코드 설정(VBS 채널 선택)](attachment:9a40915f-e266-4159-877b-f90cd0abf383:%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2025-10-05_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.39.07.png)
    
    ACCIO - VBS 체인코드 설정(VBS 채널 선택)
    
    ![ACCIO - VBS 체인코드 소스코드 업로드](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/e0307668-6094-478e-b9ce-6e26dd30c344/Untitled.png)
    
    ACCIO - VBS 체인코드 소스코드 업로드
    
- PORT-I 채널 생성 및 체인코드 배포
    
    - port-i-template.csv 파일을 선택하여 채널을 생성
    - peer0를 선택하고 채널을 생성함
    - peer1에서 Join Channel로 추가한 채널에 등록함
    - PORT-I 체인코드 설치
    
    체인코드명은 porticc 로 해야함 반드시 채널은 PORT-I 대상 채널로 총 10개를 선택해야 함
    
    ![image.png](attachment:398d2afd-1f3a-4232-b620-5bdca6d3cadc:image.png)
    
    ![image.png](attachment:f1260c02-f1e9-4ac3-94c7-75632042b862:image.png)
    

## 4. API GW 테스트(API-GW, Port-i API-GW, Port-i 관통 테스트)

<aside> 💡

API Endpoint URL은 고정적으로 생성되나, ACCIO 기술 지원팀에 요청

정상적으로는, peer 생성 후 확인해야함

</aside>

- 로드테스트
    
    ```bash
    - loadtest 디렉토리로 이동
    
    - 가상환경 세팅
    data, logs 디렉토리 생성
    **./data/terminals.csv
    ./data/itt-testcases.csv
    ./data/vbs-testcases.csv
    ./data/port-i-testcases.csv**
    
    ./logs/request_results.txt
    
    - 로커스트파일 실행
    ./start.sh
    ```
    

### 4.1. 체인코드 테스트

[](https://gitlab.smartm2m.co.kr/bpa/purging_util)

- loadtest .env.sample을 참고하여 .env 파일 생성
    
    ```bash
    # 로드 테스트
    cd loadtest
    
    ## .env 설정
    TRUCK_NO=올컨00이0000
    BASE_URL=https://bpa.acciox.dev/bpatest
    PORTI_URL=https://bpa.acciox.dev/porti-bpatest
    
    ## 로드 테스트
    ./start.sh
    ```
    
    ![로드테스트 start.sh 실행 결과](attachment:39f62b38-62a4-4c4a-8cc5-c4ccd2e3ad24:image.png)
    
    로드테스트 [start.sh](http://start.sh) 실행 결과
    

### 4.2. 상태 DB에 대한 Index 생성 요청

<aside> 💡

2025.10 추석을 기점으로 couchDB가 API-GW pods에서 분리됨으로 인해, URL 정보를 직접적으로 알 수 없으므로 ACCIO 기술 지원에 요청

단, 테스트베드의 경우 Lens를 통해 알 수 있음

</aside>

- ACCIO 기술 지원팀 진행 작업(테스트베드인 경우 진행 가능)
    
    BC_Utils의 index_test를 사용하여 index 생성을 진행.
    
    CHANNEL_NAMES를 최신버전으로 갱신하고, couchDB URL, PW를 갱신(peer0, peer1)
    
- couchDB URL 테스트베드 확인 방법
    
    테스트베드에서는 Network > ingresses > peer0-bpa-couchdb > Rule에서 URL 확인 가능
    
    ![Lens - couchDB URL 테스트베드 확인 방법](attachment:cdd05833-1a23-452b-a569-22c53278420a:image.png)
    
    Lens - couchDB URL 테스트베드 확인 방법
    
- couchDB PW 확인 (안보이면 요청)
    

![accio- couchDB PW 확인](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/4aace219-cb79-4024-9a38-37c705aa13b1/Untitled.png)

accio- couchDB PW 확인

couchDB의 PW는 accio에서 확인 가능

![mynetwork.sh Readme](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/5fc07772-734b-43f8-9141-04516d28c54b/Untitled.png)

[mynetwork.sh](http://mynetwork.sh) Readme

Readme에 따라서 shellscript 실행

```bash
- mynetwork.sh .env에서

COUCHDB1=bpa.acciox.dev/fo-e73wtkycg6/fp-e1j9wabsgn/couchdb/
COUCHDB2=bpa.acciox.dev/fo-e73wtkycg6/fp-etspwhabbd/couchdb/
PASSWORD1=4gEueIhi0X
PASSWORD2=6J9t7uEeIA
```

- Couch DB 인덱스 생성 여부 확인
    
    - index 생성 여부 확인은 couchDB URL + _utils/ 에서 확인 가능
    
    ```bash
    https://{COUCHDB1}/_utils/
    https://{COUCHDB2}/_utils/
    ID: admin
    PW: PASSWORD1
    PW: PASSWORD2
    
    ex) 
    <https://bpa.acciox.dev/fo-e73wtkycg6/fp-e1j9wabsgn/couchdb/_utils/>
    
    in_terminal-out_terminal-shipper-trucker_ittcc
    termina-shipper-trucker_vbscc
    ```
    
    - 생성된 DB에서 _ittcc, _vsscc를 찾아서 선택
    
    ![ACCIO CouchDB - 인덱스 조회](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/c3265c33-346d-47a1-b3b3-9d028088f8da/Untitled.png)
    
    ACCIO CouchDB - 인덱스 조회
    
    ![ACCIO CouchDB - 쿼리 요청 화면 이동](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/2df10846-a5cd-4f6e-b522-fb7dab8bbde8/Untitled.png)
    
    ACCIO CouchDB - 쿼리 요청 화면 이동
    
    - Run a Query With Mango 선택
        
        ![ACCIO CouchDB - 인덱스 조회 쿼리](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/35696845-8c80-4c6e-9c62-342c6b5cd2e0/Untitled.png)
        
        ACCIO CouchDB - 인덱스 조회 쿼리
        
    - manage indexes 선택
        
        ![ACCIO CouchDB - 인덱스 생성 결과 확인](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/d2613f07-7678-44eb-a2f9-712213c7b932/Untitled.png)
        
        ACCIO CouchDB - 인덱스 생성 결과 확인
        
    - 이 화면에서 인덱스 생성 결과를 확인 가능
        
        ![ACCIO CouchDB - 인덱스 생성 결과](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/2d6c6b5d-1e25-491d-8e3f-be06ac7a5dbd/Untitled.png)
        
        ACCIO CouchDB - 인덱스 생성 결과
        
    - 위와 같이 모든 요소들에 대한 인덱스가 생성되면 완료
        

## 5. 최종 시나리오 연계 테스트

위의 과정까지 진행됬을 경우, 연계 모듈을 대상으로 시나리오 테스트를 수행하여 최종 상태점검

⇒ 외부기관(컨테인어스)과 함께 진행

-끝-

# #. API-GW 배포

[](https://gitlab.smartm2m.co.kr/baas/bpa/fabric-api-peer)

- docker-registry 로그인
    
    ```bash
    # ACCIO docker-registry 로그인
    docker login registry.accio.technology
    # user: deployment
    # pass: nmPUmrEoE2erur3yAqPk
    ```
    
    빌드 및 이미지 업로드를 위해 로그인 필요, 로그인 하지 않을 시 빌드는 되지만 배포가 진행되지 않음
    
- 브랜치 accio-compatible에서 작업 진행
    

```bash
cd src
./deployment.sh
# 운영망일 경우: y / 테스트베드일 경우: n
# 네임스페이스 확인 시: 엔터
# AMD64 확인 시: y
```

![image.png](attachment:46c2014c-6374-4e3c-9147-a2d91c76b6ba:image.png)

![image.png](attachment:a91c8782-61ad-4dc6-bc42-ec86f88aecde:image.png)

## #. 체인코드 업데이트

체인코드는 원래 한번 배포되면 되돌릴 수 없지만, ACCIO의 기능을 통해서 대치가능하다.

체인코드 업데이트는 다음과 같이 진행

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/576e45a5-4719-4527-afe6-44fb3fb17b18/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/7f09dfa7-bbb2-45fe-be99-f5f568cbb5c4/64272d47-ae33-48b9-974e-2a77d7858d34/image.png)

---

## 이슈 사항

- API-GW PODS에 문제가 발생했을 때, 재배포 필요
    
    ![image.png](attachment:4142f902-1a57-4d1d-bf70-ebe6d1f0d147:image.png)
    
    프로덕션의 경우, ACCIO 기술 지원팀에 요청
    
    테스트베드의 경우, 재배포 진행
    
    - API-GW
        
        ![image.png](attachment:60669d43-3cbf-4167-bbc3-4e2571da8fc9:image.png)
        
    - Port-i API-GW
        
    
    브랜치 변경 후 배포 실행
    
    ![image.png](attachment:0e094de3-ba55-4fbe-8b0e-841cc03a25e0:image.png)
    
    ![image.png](attachment:46c2014c-6374-4e3c-9147-a2d91c76b6ba:image.png)
    
    ![image.png](attachment:a91c8782-61ad-4dc6-bc42-ec86f88aecde:image.png)
    
    - Lens에서 pod 재확인
        
        ![image.png](attachment:bc3671ee-c848-4a7b-9abf-9b786098ee64:image.png)
        
- 그 외에 pods 문제 생겼을 경우, ACCIO 기술지원팀에 요청