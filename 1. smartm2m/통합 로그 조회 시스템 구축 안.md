# 로그 중앙화 시스템 최종 정리

## 전체 스택

### 각 IDC (10개 터미널)

1. **커스텀 라이브러리** (ESLogger - Log4j Wrapper)
2. **Filebeat**

### 중앙 서버

3. **Nexus** (라이브러리 저장소)
4. **Kafka**
5. **Kafka Connect** (ES Sink)
6. **Elasticsearch**
7. **Kibana** (관리자용)
8. **커스텀 UI** (개발자용)

---

## 선정 이유

| 스택                | 선정 이유                                                                                      |
| ----------------- | ------------------------------------------------------------------------------------------ |
| **커스텀 라이브러리**     | • import만 변경으로 적용 (코드 동일)<br>• 터미널별 로깅 방식/용어 통일<br>• 공통 필드 표준화 + 원본 보존<br>• 기존 Log4j 영향 없음 |
| **Filebeat**      | • 파일 → Kafka 전송 표준 도구<br>• 경량, 안정적, 백프레셔 처리                                                |
| **Nexus**         | • 라이브러리 중앙 배포<br>• 버전 관리 용이                                                                |
| **Kafka**         | • 10개 IDC 로그 중앙 버퍼<br>• 로그 유실 방지<br>• 이미 운영 중                                              |
| **Kafka Connect** | • Kafka → ES 자동 전송<br>• 코드 불필요, 경량                                                         |
| **Elasticsearch** | • 대용량 로그 검색/저장                                                                             |
| **Kibana**        | • ES 관리, 긴급 상황 백업                                                                          |
| **커스텀 UI**        | • 컨테이너 추적 특화 인터페이스                                                                         |

---

## 전체 흐름

```
[라이브러리 배포]
  Nexus (중앙 Maven 저장소)
    → 각 터미널 pom.xml에서 참조

[각 IDC - 10곳]
  터미널 에이전트
    → ESLogger (import만 변경, 코드 동일)
    → 표준 JSON 생성
    → logs/dev-trace.log
    → Filebeat
         ↓
[중앙 서버]
    Kafka
    → Kafka Connect
    → Elasticsearch
    → Kibana + 커스텀 UI
```

---

## 라이브러리 적용 방식

### Phase 1: 투명 적용

```java
// 변경 전
import org.slf4j.Logger;
private static final Logger logger = LoggerFactory.getLogger(MyClass.class);

// 변경 후 (import만)
import com.company.trace.ESLogger;
private static final ESLogger logger = ESLogger.getLogger(MyClass.class);

// 사용 코드는 완전 동일
logger.info("처리 완료");
```

### Phase 2: 선택적 강화

```java
// 상세 추적 필요시
logger.eslog()
    .containerNo("CNTR123")
    .eventType("GATE_IN")
    .send();
```

---

## 핵심 특징

✅ **최소 변경**: import만 수정, 코드 동일  
✅ **표준화**: 공통 필드로 통합 검색  
✅ **유연성**: 원본 데이터 보존  
✅ **안정성**: Kafka 버퍼, 기존 Log4j 무영향  
✅ **확장성**: 라이브러리만 배포하면 적용 완료  
✅ **점진 도입**: 터미널별 단계적 적용 가능