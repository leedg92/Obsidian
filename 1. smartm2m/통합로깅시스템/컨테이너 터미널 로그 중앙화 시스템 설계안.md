
## 1. 전체 변환 라이브러리 적용의 한계

### 현실적 어려움

- **터미널마다 환경 상이**: Java 8/11/17, 로깅 라이브러리(logback/log4j/log4j2) 혼재
- **로그 형태 다양**: JSON, Map, String, Object 등 데이터 타입 제각각
- **도커 환경 복잡도**: 같은 터미널 내에서도 컨테이너별로 Java 버전 다름
- **클래스별 로깅 방식 차이**: 같은 프로젝트 내에서도 개발자마다 로깅 방법 상이

### 예상 공수

- 10개 터미널 × 평균 5개 프로젝트 = **최소 50개 배포**
- 각 환경별 테스트 및 배포 일정 조율
- 예상 소요 시간: **3~6개월**
- 운영 시스템 수정에 따른 **높은 리스크**

---

## 2. 단순 수집 방식(레이크)의 장점

### "메시지:데이터" 형태로만 수집

```java
// 기존 시스템은 건드리지 않음
// Fluentd/Filebeat가 로그 파일 그대로 수집
```

### 핵심 장점

✅ **기존 시스템 무변경**: 운영 중인 터미널 시스템 수정 불필요  
✅ **빠른 구축**: 2주 내 로그 수집 시작 가능  
✅ **리스크 최소화**: 로그 수집기만 추가, 애플리케이션 안정성 영향 없음  
✅ **완전한 데이터 보존**: 원본 그대로 저장으로 재분석 가능  
✅ **점진적 개선**: 실제 데이터 확인 후 표준 정의 가능

---

## 3. ClickHouse 데이터베이스 구조

```
┌─────────────────────────────────────────────────┐
│                 Kafka 토픽 10개                  │
│    (terminal1-logs ~ terminal10-logs)           │
└────────────────┬────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────────────┐
│         ClickHouse Kafka 테이블 (1개)            │
│          (10개 토픽 동시 구독)                   │
└────────────────┬────────────────────────────────┘
                 ↓
          ┌──────────────┐
          │     MV1      │ (단순 이관)
          └──────┬───────┘
                 ↓
       ┌──────────────────┐
       │   레이크 테이블    │
       │   (원본 보존)     │
       └──────┬───────────┘
              ↓
       [데이터 분석]
       (2주간 패턴 파악)
              ↓
       ┌──────────────┐
       │     MV2      │ (파싱/정제) - 나중에 추가
       └──────┬───────┘
              ↓
    ┌──────────────────┐
    │  웨어하우스 테이블  │
    │  (정제 데이터)    │
    └──────────────────┘
```
### 테이블 구조

**레이크 테이블** (logs_lake)

- raw_message: String (원본 로그 그대로)
- timestamp: String
- terminal_id: UInt8
- received_at: DateTime

**웨어하우스 테이블** (logs_warehouse) - 나중에 추가

---

## 4. 레이크를 두는 이점

### 데이터 보존 관점

📌 **원본 데이터 영구 보존**

- 로그 형태가 달라도 String으로 모두 수용
- 정제 로직 실수해도 재처리 가능
- 예상치 못한 분석 요구사항 대응

### 운영 관점

📌 **단계적 구축 가능**

```
Week 1-2: 레이크 구축 (일단 모으기)
Week 3-4: 데이터 분석 (패턴 파악)
Week 5+:  정제 레이어 추가 (점진적)
```

### 비용 관점

📌 **효율적 데이터 관리**

- 레이크: 원본 2년 보관 (저렴한 스토리지)
- 웨어하우스: 정제된 최근 6개월만 (빠른 조회)

---

## 5. Materialized View로 정제하는 이점

### 즉시 서비스 가능

```
레이크 구축 완료 → 바로 조회/분석 가능
(정제 안 되어도 서비스 시작 가능)
```

### 점진적 개선

```sql
-- 1단계: 레이크만 (원본 그대로)
레이크 테이블 → 조회/분석

-- 2단계: 분석 후 MV 추가 (정제 레이어)
레이크 → MV2 → 웨어하우스 → 더 나은 조회
```

### 핵심 장점

✅ **비침투적 개선**: 레이크 운영하면서 동시에 정제 레이어 구축  
✅ **로직 변경 용이**: MV만 수정하면 됨, 원본은 그대로  
✅ **독립적 테스트**: 정제 로직 검증 후 적용 가능  
✅ **획일화된 서비스**: 표준 스키마 확정 후 점진적 도입

### 실무 흐름

```
1. 레이크에 2주간 데이터 수집
   ↓
2. 실제 로그 패턴 분석
   - 터미널별 로그 형태 파악
   - 공통 필드 정의 (5~10개)
   ↓
3. MV2 생성 (정제 로직)
   - 레이크는 계속 운영 중
   - 웨어하우스에 정제된 데이터 쌓임
   ↓
4. 서비스 점진적 전환
   - 신규 대시보드: 웨어하우스 사용
   - 레거시 분석: 레이크 계속 사용
```

---

## 6. 구조 비교

### ❌ 전체 변환 방식

```
각 터미널 (50개 프로젝트)
  → 커스텀 라이브러리 적용
  → 표준 형태로 변환
  → Kafka
  → ClickHouse

문제점:
- 3~6개월 소요
- 운영 시스템 수정 리스크
- 표준이 틀리면 전체 재배포
```

### ✅ 레이크 우선 방식

```
각 터미널
  → 기존 로그 그대로
  → Fluentd 수집
  → Kafka
  → ClickHouse 레이크 (2주 완료)
  → MV → 웨어하우스 (점진적)

장점:
- 2주 내 구축
- 기존 시스템 무변경
- 실제 데이터로 표준 검증
- 단계적 개선
```

---

## 7. 결론

### 제안 방식

**1단계 (2주)**: 레이크 구축 - 일단 다 모으기  
**2단계 (1개월)**: 데이터 분석 - 표준 정의  
**3단계 (점진적)**: MV로 정제 - 획일화 서비스 제공

### 핵심 메시지

> "완벽한 표준을 만들어서 적용하기보다,  
> 실제 데이터를 먼저 모아서 분석하고,  
> 검증된 표준으로 점진적 개선"

**리스크 최소화 + 빠른 가치 제공**