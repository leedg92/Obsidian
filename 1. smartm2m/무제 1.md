<source>  
  @type forward  
  port 24224  
  bind 0.0.0.0  
</source>

#<match **>  
#  @type stdout  
#</match>  
<filter docker.**>  
  @type parser  
  key_name log  
  reserve_data true  
  remove_key_name_field true  
<parse>  
    @type json  
</parse>  
</filter>  
<filter docker.**>  
  @type record_modifier  
<record>  
    traceId ${record["traceId"] || record.dig("data", "pinNo") || record.dig("data", "PINNO") || record.dig("data", "docKey") || record.dig("data", "DOCKEY") || ""}  
</record>  
</filter>  
<match docker.**>  
  @type copy  
<store>  
    @type loki

    url [http://loki.bct.com:3100](http://loki.bct.com:3100 "http://loki.bct.com:3100/")

    remove_keys container_id  
    line_format json  
<label>  
      container_name $.container_name  
      service_type $.service_type  
      role $.role  
      event_type $.event_type  
      terminal $.terminal  
      level $.level  
</label>  
<buffer>  
      @type file  
      path /fluentd/log/loki_buffer  
      flush_interval 5s  
</buffer>

    <inject>  
      tag_keys  
</inject>  
</store>  
<store>  
    @type kafka2  
    brokers 133.186.213.152:39092,133.186.213.152:39093,133.186.213.152:39094  
    default_topic bct-terminal-log

    <format>  
      @type json  
</format>

    max_send_retries 3  
    required_acks -1

    <buffer>  
      @type file  
      path /fluentd/log/kafka_buffer  
</buffer>  
</store>  
</match>