# LiveKit 실시간 미디어 서버

  

WebRTC 기반의 고성능 실시간 영상, 음성, 데이터 통신 서버입니다. 멀티 사용자 화상회의와 실시간 스트리밍을 위한 확장 가능한 SFU(Selective Forwarding Unit) 서버를 제공합니다.

  

[![GitHub stars](https://img.shields.io/github/stars/livekit/livekit?style=social&label=Star&maxAge=2592000)](https://github.com/livekit/livekit/stargazers/)

[![Slack community](https://img.shields.io/endpoint?url=https%3A%2F%2Flivekit.io%2Fbadges%2Fslack)](https://livekit.io/join-slack)

[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/livekit/livekit)](https://github.com/livekit/livekit/releases/latest)

[![License](https://img.shields.io/github/license/livekit/livekit)](https://github.com/livekit/livekit/blob/master/LICENSE)

  

## 🚀 주요 기능

  

- **고성능 SFU**: 확장 가능한 분산 WebRTC SFU (Selective Forwarding Unit)

- **멀티 플랫폼 SDK**: 모든 주요 플랫폼용 클라이언트 SDK 제공

- **프로덕션 지원**: JWT 인증, 보안 및 모니터링 기능

- **강력한 네트워킹**: UDP/TCP/TURN 지원으로 안정적인 연결

- **간편한 배포**: 단일 바이너리, Docker, Kubernetes 지원

- **고급 기능**:

  - 화자 감지 (Speaker Detection)

  - 동시 다중 스트림 (Simulcast)

  - 종단간 최적화

  - 선택적 구독 (Selective Subscription)

  - 참가자 관리 API

  - 종단간 암호화

  - SVC 코덱 (VP9, AV1)

  - 웹훅 (Webhooks)

  - 분산 및 다중 리전 지원

  

## 📦 빠른 시작

  

### 저장소 클론 및 빌드

```bash

git clone https://github.com/livekit/livekit

cd livekit

  

# Go 1.23+ 필수

go mod download

go build ./cmd/server

```


### 🚀 빠른 시작 가이드

  

#### Step 1: 서버 시작

```bash

make setup && make up

```

  

#### Step 2: 토큰 테스트  

```bash

# 상담자용 토큰

make token USER_ID=counselor ROOM=support_test

  

# 사용자용 토큰

make token USER_ID=user123 ROOM=support_test

```

  

#### Step 3: 브라우저 테스트

```bash

make browser-test  # meet.livekit.io 접속 방법 확인

```


## 🔧 사용 가능한 명령어 (Makefile 기반)
  
### 환경 설정 및 서버 관리

```bash

# 📋 전체 명령어 도움말

make help

  

# 🔧 환경 설정 + 빌드 (처음 실행시)

make setup       # 외부 IP 감지, 컨테이너 정리, Docker 이미지 빌드

  

# 🚀 서버 시작/중지

make up          # LiveKit 서버 시작 (빌드 없이 실행)

make down        # LiveKit 서버 중지

make restart     # LiveKit 서버 재시작

  

# 📊 상태 확인 및 로그

make status      # LiveKit 상태 확인

make logs        # LiveKit 실시간 로그 확인

make monitor     # 빌드 상황 실시간 모니터링

```

  

### JWT 토큰 생성 (중요!)

```bash

# 🔑 기본 토큰 생성 (User1, test-room)

make token

  

# 🔑 특정 사용자 토큰

make token USER_ID=Alice

  

# 🔑 특정 방 토큰  

make token ROOM=meeting-room

  

# 🔑 사용자+방 지정

make token USER_ID=Bob ROOM=team-meeting

  

# 🔑 빠른 토큰 생성 (별칭)

make token-user1  # User1용 토큰

make token-user2  # User2용 토큰

```

  

### 테스트 및 진단

```bash

# 🧪 연결 테스트

make test-connect    # HTTP API 연결 테스트

make test-health     # 헬스체크 + 포트 바인딩 확인

make test-network    # Bridge 네트워크 종합 테스트

  

# 🌐 브라우저 테스트 가이드

make browser-test    # meet.livekit.io 접속 방법 안내

  

# 🔍 실시간 진단

make debug          # 브라우저 접속 문제 진단

```

  

### 방화벽 관리 (필요시)

```bash

# 🔓 LiveKit 포트 열기

make firewall-open     # ufw 활성화 + 필요 포트 개방

  

# 🔒 LiveKit 포트 닫기  

make firewall-close    # LiveKit 포트만 차단

  

# 🔍 방화벽 상태 확인

make firewall-status   # 현재 방화벽 설정 확인

  

# ⚠️ 방화벽 완전 비활성화 (주의!)

make firewall-disable  # 모든 포트 개방 (보안 위험)

```

  

### 개발자 도구

```bash

# 🔄 개발환경 초기화

make dev-reset      # 볼륨 포함 완전 초기화

make dev-shell      # LiveKit 컨테이너 내부 접속

  

# 🔧 환경 정보 확인

make env           # 현재 환경 설정 확인

  

# 🐳 Docker 관련 (직접 사용시)

make build         # Docker 이미지만 빌드

docker-compose ps  # 컨테이너 상태 확인

```

  

## 📂 프로젝트 구조

  

```

livekit/

├── cmd/

│   └── server/                     # 메인 서버 애플리케이션

│       ├── main.go                 # 서버 엔트리포인트

│       └── commands.go             # CLI 명령어

├── pkg/

│   ├── rtc/                        # RTC 핵심 로직

│   │   ├── room.go                 # 룸 관리

│   │   ├── participant.go          # 참가자 관리

│   │   └── mediatrack.go           # 미디어 트랙 처리

│   ├── service/                    # 서비스 레이어

│   │   ├── server.go               # HTTP/gRPC 서버

│   │   ├── roomservice.go          # 룸 서비스

│   │   └── auth.go                 # 인증 서비스

│   ├── routing/                    # 라우팅 및 분산

│   │   ├── localrouter.go          # 로컬 라우터

│   │   └── redisrouter.go          # Redis 기반 분산 라우터

│   ├── sfu/                        # SFU 구현

│   │   ├── downtrack.go            # 다운스트림 트랙

│   │   ├── receiver.go             # 수신기

│   │   └── forwarder.go            # 전달기

│   └── config/                     # 설정 관리

├── config-sample.yaml              # 설정 파일 예제

├── docker-compose.yml              # Docker 개발 환경

├── Dockerfile                      # Docker 이미지 빌드

└── README.md

```

  

## ⚙️ 환경 설정

  

### 기본 설정 파일

```yaml

# config-dev.yaml

port: 7880

rtc:

  tcp_port: 7881

  port_range_start: 7882

  port_range_end: 7882

  use_external_ip: true

  

keys:

  devkey: secret

  

log_level: debug

development: true

```

  

### 환경 변수

```bash

# 서버 포트

LIVEKIT_PORT=7880

  

# RTC 설정

LIVEKIT_RTC_TCP_PORT=7881

LIVEKIT_RTC_PORT_RANGE_START=7882

LIVEKIT_RTC_PORT_RANGE_END=7892

  

# 개발 모드

LIVEKIT_DEVELOPMENT=true

LIVEKIT_LOG_LEVEL=debug

  

# API 키 설정

LIVEKIT_KEYS=devkey:secret

```



### 💡 핵심 API 엔드포인트

  

| 용도 | HTTP 메서드 | 엔드포인트 | 설명 |

|------|-------------|-----------|------|

| 룸 생성 | `POST` | `/twirp/livekit.RoomService/CreateRoom` | 새 상담 룸 생성 |

| 토큰 생성 | `make token` | `USER_ID=xxx ROOM=xxx` | JWT 토큰 발행 |

| WebRTC 연결 | `WebSocket` | `/rtc` | 실시간 통신 |

| 룸 삭제 | `POST` | `/twirp/livekit.RoomService/DeleteRoom` | 상담 종료 |

  

### 🔧 개발자별 사용법

  

#### **JavaScript 개발자 (상담자 웹)**

```javascript

// 기본 연결

import { Room } from 'livekit-client';

const room = new Room();

await room.connect('ws://localhost:7880', token);

  

// 화면 수신 대기

room.on('trackSubscribed', (track) => { /* 화면 표시 */ });

```

  

#### **Flutter 개발자 (사용자 앱)**  

```dart

// LiveKit Flutter SDK 사용

import 'package:livekit_client/livekit_client.dart';

  

// 화면 공유 시작

final room = Room();

await room.connect(serverUrl, token);

await room.localParticipant?.enableVideo(true);  // 화면 미러링

```

  

#### Go 클라이언트 (서버 사이드)

```go

package main

  

import (

    "context"

    "github.com/livekit/protocol/auth"

    "github.com/livekit/protocol/livekit"

    lksdk "github.com/livekit/server-sdk-go"

)

  

// 토큰 생성 (서버에서)

func createToken(apiKey, apiSecret, room, identity string) (string, error) {

    at := auth.NewAccessToken(apiKey, apiSecret)

    grant := &auth.VideoGrant{

        RoomJoin: true,

        Room:     room,

    }

    at.AddGrant(grant).SetIdentity(identity)

    return at.ToJWT()

}

  

// 룸 관리 API 사용

func manageRooms() {

    roomClient := lksdk.NewRoomServiceClient("http://localhost:7880", "devkey", "secret")

    // 룸 생성

    room, err := roomClient.CreateRoom(context.Background(), &livekit.CreateRoomRequest{

        Name: "meeting-room",

    })

    // 룸 목록 조회

    rooms, err := roomClient.ListRooms(context.Background(), &livekit.ListRoomsRequest{})

    // 참가자 목록 조회

    participants, err := roomClient.ListParticipants(context.Background(), &livekit.ListParticipantsRequest{

        Room: "meeting-room",

    })

}

```

  

### 🔗 Step 5: REST API로 룸 관리

  

#### 룸 생성

```bash

curl -X POST http://localhost:7880/twirp/livekit.RoomService/CreateRoom \

  -H "Content-Type: application/json" \

  -H "Authorization: Bearer $(make token USER_ID=admin ROOM=control | grep Token | cut -d' ' -f2)" \

  -d '{

    "name": "new-meeting-room",

    "empty_timeout": 300,

    "max_participants": 10

  }'

```

  

#### 룸 목록 조회

```bash

curl -X POST http://localhost:7880/twirp/livekit.RoomService/ListRooms \

  -H "Content-Type: application/json" \

  -H "Authorization: Bearer $(make token USER_ID=admin ROOM=control | grep Token | cut -d' ' -f2)" \

  -d '{}'

```

  

#### 참가자 제거

```bash

curl -X POST http://localhost:7880/twirp/livekit.RoomService/RemoveParticipant \

  -H "Content-Type: application/json" \

  -H "Authorization: Bearer $(make token USER_ID=admin ROOM=control | grep Token | cut -d' ' -f2)" \

  -d '{

    "room": "meeting-room",

    "identity": "troublesome-user"

  }'

```

  

### 🎥 Step 6: 고급 기능 활용

  

#### 데모 스트림 발행 (테스트용)

```bash

# LiveKit CLI를 통한 데모 비디오 스트리밍

# (LiveKit CLI가 설치된 경우)

lk room join \

    --url ws://localhost:7880 \

    --api-key devkey --api-secret secret \

    --identity demo-publisher \

    --publish-demo \

    meeting-room

```

  

#### 녹화 설정 (Egress 연동시)

```javascript

// 녹화 시작

const recording = await room.startRecording({

  file: {

    filepath: '/recordings/meeting.mp4'

  }

});

  

// 녹화 중지  

await room.stopRecording(recording.egressId);

```

  

#### 실시간 스트리밍 (RTMP)

```javascript

// RTMP 스트림 시작

const stream = await room.startLiveStream({

  rtmp: {

    urls: ['rtmp://stream.example.com/live/stream-key']

  }

});

```

  

### 🔧 Step 7: 문제 해결

  

#### 연결 문제 진단

```bash

# 네트워크 테스트

make test-network

  

# 실시간 로그 확인  

make logs

  

# 포트 바인딩 확인

netstat -tlnp | grep -E "(7880|7881|3478)"

```

  

#### 방화벽 문제 해결

```bash

# 방화벽 상태 확인

make firewall-status

  

# 필요 포트 열기

make firewall-open

  

# 또는 일시적으로 방화벽 비활성화 (개발용)

sudo ufw disable

```

  

## 🌍 API 엔드포인트 및 사용법

  

### 관리 API (JWT 토큰 인증 필요)

```bash

# 기본 URL: http://localhost:7880

# 인증: Authorization: Bearer {JWT_TOKEN}

```

  

#### 룸 관리

```bash

# 🏠 룸 생성

POST /twirp/livekit.RoomService/CreateRoom

{

  "name": "meeting-room",

  "empty_timeout": 300,

  "max_participants": 20,

  "metadata": "Custom room metadata"

}

  

# 📋 룸 목록 조회

POST /twirp/livekit.RoomService/ListRooms

{}

  

# 🗑️ 룸 삭제

POST /twirp/livekit.RoomService/DeleteRoom

{

  "room": "meeting-room"

}

  

# 📊 룸 정보 조회

POST /twirp/livekit.RoomService/GetRoom  

{

  "room": "meeting-room"

}

```

  

#### 참가자 관리

```bash

# 👥 참가자 목록 조회

POST /twirp/livekit.RoomService/ListParticipants

{

  "room": "meeting-room"

}

  

# 🚫 참가자 제거 (강제 퇴장)

POST /twirp/livekit.RoomService/RemoveParticipant

{

  "room": "meeting-room",

  "identity": "user-to-remove"

}

  

# 🔇 참가자 음소거

POST /twirp/livekit.RoomService/MutePublishedTrack

{

  "room": "meeting-room",

  "identity": "noisy-user",

  "track_sid": "TR_audio_track_id",

  "muted": true

}

  

# ✏️ 참가자 메타데이터 수정

POST /twirp/livekit.RoomService/UpdateParticipant

{

  "room": "meeting-room",

  "identity": "participant",

  "metadata": "Updated metadata",

  "permission": {

    "can_subscribe": true,

    "can_publish": false

  }

}

```

  

### WebRTC 연결 엔드포인트

```bash

# 🔗 WebSocket 시그널링

WS /rtc

# 연결시 JWT 토큰 필요 (URL 파라미터 또는 헤더)

  

# ✅ 토큰 검증

GET /rtc/validate?access_token={JWT_TOKEN}

  

# 📊 서버 상태 확인  

GET /

# 응답: 200 OK (서버 정상)

```

  

### 실제 API 호출 예제

  

#### 토큰으로 인증된 API 호출

```bash

# 1. 관리자용 토큰 생성

ADMIN_TOKEN=$(make token USER_ID=admin ROOM=control | grep Token | cut -d' ' -f2)

  

# 2. 룸 생성

curl -X POST http://localhost:7880/twirp/livekit.RoomService/CreateRoom \

  -H "Content-Type: application/json" \

  -H "Authorization: Bearer $ADMIN_TOKEN" \

  -d '{

    "name": "team-meeting",

    "empty_timeout": 600,

    "max_participants": 50,

    "metadata": "{\"description\": \"팀 회의방\", \"created_by\": \"admin\"}"

  }'

  

# 3. 생성된 룸 확인

curl -X POST http://localhost:7880/twirp/livekit.RoomService/ListRooms \

  -H "Content-Type: application/json" \

  -H "Authorization: Bearer $ADMIN_TOKEN" \

  -d '{}'

```

  

#### 참가자 관리 예제

```bash

# 특정 룸의 참가자 확인

curl -X POST http://localhost:7880/twirp/livekit.RoomService/ListParticipants \

  -H "Content-Type: application/json" \

  -H "Authorization: Bearer $ADMIN_TOKEN" \

  -d '{

    "room": "team-meeting"

  }'

  

# 문제가 있는 참가자 강제 퇴장

curl -X POST http://localhost:7880/twirp/livekit.RoomService/RemoveParticipant \

  -H "Content-Type: application/json" \

  -H "Authorization: Bearer $ADMIN_TOKEN" \

  -d '{

    "room": "team-meeting",

    "identity": "disruptive-user"

  }'

```

  

### 토큰 기반 권한 제어

  

#### 다양한 권한의 토큰 생성

```bash

# 👥 일반 참가자 (시청+발언 가능)

make token USER_ID=participant1 ROOM=meeting

  

# 👀 시청자 전용 (발언 불가)

# config에서 권한 설정 또는 서버 SDK 사용 필요

  

# 🎥 녹화 봇 (숨김 참가자)

docker-compose exec livekit /livekit-server create-join-token \

  --config /etc/livekit.yaml \

  --room meeting \

  --identity recorder-bot \

  --recorder

  

# 👨‍💼 관리자 (모든 권한)  

make token USER_ID=admin ROOM=control

```

  

## 🐳 Docker 사용법

  

### 개발 환경

```bash

# 개발 서버 시작

docker-compose up -d

  

# 로그 확인

docker-compose logs -f livekit

  

# 컨테이너 상태 확인

docker-compose ps

```

  

### 프로덕션 배포

```yaml

# docker-compose.prod.yml

version: '3.8'

services:

  livekit:

    image: livekit/livekit-server:latest

    ports:

      - "7880:7880"

      - "7881:7881"

      - "7882-7892:7882-7892/udp"

    volumes:

      - ./config.yaml:/etc/livekit.yaml

    command: --config /etc/livekit.yaml

```

  

## 🔒 보안 및 인증

  

### JWT 토큰 기반 인증

```go

// 서버 측 토큰 생성 예제

import "github.com/livekit/protocol/auth"

  

token := auth.NewAccessToken("api-key", "api-secret")

grant := &auth.VideoGrant{

    RoomJoin: true,

    Room:     "my-room",

}

token.AddGrant(grant).SetIdentity("user-id")

jwt, _ := token.ToJWT()

```

  

### 보안 모범 사례

- 프로덕션 환경에서는 반드시 고유한 API 키 사용

- HTTPS/WSS 연결 강제 설정

- 적절한 방화벽 규칙 설정

- 토큰 만료 시간 설정

  

## 📊 모니터링 및 로깅

  

### Prometheus 메트릭

```yaml

# config.yaml

prometheus:

  port: 6789

# Grafana 대시보드 사용 가능

# deploy/grafana/livekit-server-overview.json

```

  

### 로그 레벨 설정

```yaml

log_level: info  # debug, info, warn, error

development: false

```

  
  

## 📚 SDK 및 예제

  

### 클라이언트 SDK

- [JavaScript/TypeScript](https://github.com/livekit/client-sdk-js)

- [Swift (iOS/macOS)](https://github.com/livekit/client-sdk-swift)

- [Android](https://github.com/livekit/client-sdk-android)

- [Flutter](https://github.com/livekit/client-sdk-flutter)

- [React Native](https://github.com/livekit/client-sdk-react-native)

  

### 서버 SDK

- [Go](https://github.com/livekit/server-sdk-go)

- [Node.js](https://github.com/livekit/server-sdk-js)

- [Python](https://github.com/livekit/python-sdks)

- [Ruby](https://github.com/livekit/server-sdk-ruby)

  

### 예제 애플리케이션

- [LiveKit Meet](https://github.com/livekit-examples/meet) - 화상회의 앱

- [공간 오디오](https://github.com/livekit-examples/spatial-audio) - 3D 오디오

- [라이브 스트리밍](https://github.com/livekit-examples/livestream) - OBS 연동

  

## 🔗 생태계 도구

  

- **[Agents](https://github.com/livekit/agents)**: AI 기반 실시간 멀티모달 애플리케이션 구축

- **[Egress](https://github.com/livekit/egress)**: 룸 녹화 및 멀티 스트림, 개별 트랙 내보내기

- **[Ingress](https://github.com/livekit/ingress)**: RTMP, WHIP, HLS, OBS Studio 등 외부 소스 수집